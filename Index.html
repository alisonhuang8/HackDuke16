
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
    <title>NetID Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Pragma" content="no-cache">
    <script src="/idp/js/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="/idp/js/jquery-ui-1.11.4.custom/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/idp/js/fingerprint2.js" type="text/javascript"></script>
    <link href="/idp/js/jquery-ui-1.11.4.custom/jquery-ui.min.css" rel="stylesheet" type="text/css" />
    <link href="/idp/css/idp.css" rel="stylesheet" type="text/css" />
    <link href="/idp/css/handheld.css" rel="stylesheet" media="handheld, only screen and (min-device-width: 320px) and (max-device-width: 768px)" />

    <script type="text/javascript">
      jQuery.extend({
        isValidSelector: function(selector) {
          try {
            var $element = $(selector);
          } catch(error) {
            return false;
          }

          return true;
        }
      });

      function passwordPopulated() {
        if ($("#j_password").val().length > 0 || ($.isValidSelector("input:-webkit-autofill") && $("#j_password:-webkit-autofill").length > 0)) {
          return true;
        }

        return false;
      }

      function checkDeviceReady(done) {
        if ($("#mfaCookie_extra").val() == "1") {
          done();
        } else {
          setTimeout(function(){ checkDeviceReady(done); }, 25);
        }
      }

      function checkDevice() {
        var FP = new Fingerprint2();

        if ($("#mfaCookie_fp1").val().length == 0) {
          try {
            var theVal = FP.getCanvasFp();
            if (theVal.length > 128) {
              theVal = FP.x64hash128(theVal, 31);
            }
            $("#mfaCookie_fp1").val(theVal);
          } catch(err) {
            // ignore
          }
        }

        if ($("#mfaCookie_fp2").val().length == 0) {
          try {
            var theVal = FP.getWebglFp();
            if (theVal.length > 128) {
              theVal = FP.x64hash128(theVal, 31);
            }
            $("#mfaCookie_fp2").val(theVal);
          } catch(err) {
            // ignore
          }
        }

        if ($("#mfaCookie_plugins").val().length == 0) {
          try {
            var theVal = "";
            if(FP.isIE()){
              theVal = FP.getIEPluginsString();
            } else {
              theVal = FP.getRegularPluginsString();
            }

            if (theVal.length > 128) {
              theVal = FP.x64hash128(theVal, 31);
            }
            $("#mfaCookie_plugins").val(theVal);
          } catch(err) {
            // ignore
          }
        }

        if ($("#mfaCookie_timezone").val().length == 0) {
          $("#mfaCookie_timezone").val(new Date().getTimezoneOffset());
        }

        if ($("#mfaCookie_screen").val().length == 0) {
          $("#mfaCookie_screen").val(screen.height + "," + screen.width + "," + screen.availHeight + "," + screen.availWidth);
        }

        if ($("#mfaCookie_language").val().length == 0) {
          $("#mfaCookie_language").val(navigator.language);
        }

        if ($("#mfaCookie_fonts").val().length == 0) {
          try {
            var keys = [];
            FP.jsFontsKey(keys, function(newKeys) {
              var theVal = newKeys[0];
              if (theVal.length > 128) {
                theVal = FP.x64hash128(theVal, 31);
              }
              $("#mfaCookie_fonts").val(theVal);
              $("#mfaCookie_extra").val("1");
            });
          } catch(err) {
            // ignore
            $("#mfaCookie_extra").val("1");
          }
        } else {
          $("#mfaCookie_extra").val("1");
        }
      }

      $(function() {
        var valMap = [0, 12, 24, 72];
        $("#rememberme_slider").slider({
          min: 0,
          max: valMap.length - 1,
          value: 0,
          slide: function(event, ui) {
            $("#rememberme_value").val(valMap[ui.value]);
            $("#rememberme_value_span").text(valMap[ui.value]);
          }
        });
      });
    </script>

    <script src="/idp/js/boomerang-oit.js" type="text/javascript"></script>
    <script type="application/javascript">
      var isAgent = {
        OutlookApp: function() {
          return navigator.userAgent.match(/iPhone/);
        },
        any: function() {
          return (isAgent.OutlookApp());
        }
      };
    (function() {
      if( isAgent.any() ) { return; };
      // random beacon sampling
      var epoch = Math.floor(Date.now() / 1000);
      var urls = ["https://beacon.oit.duke.edu"];
      var num = Math.floor(Math.random() * urls.length);
      host = urls[num].replace(new RegExp('http.*://',''),'');
      var clientip = "10.188.81.124";
      var server = "shib.oit.duke.edu";
      BOOMR.init({
           beacon_url: "https://via.oit.duke.edu/boomerangs/boompost",
           site_domain: server,
           user_ip: clientip,
           beacon_type: 'POST',
           BW: {
             base_url: urls[num] + '/images/',
             cookie: server + '-bw',
             cookie_exp: 120,
             test_https: true,
             block_beacon: true
           },
           RT: {
             cookie: server + '-rt',
             cookie_exp: 120,
             test_https: true,
             block_beacon: true
           }
      }).
      addVar({
       "clientip": clientip,
       "useragent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.98 Safari/537.36",
       "http_ver": "HTTP/1.1",
       "method": "GET",
       "req_time": epoch,
       "uri_path": "/idp/login.jsp",
       "host": host,
       "protocol": "https"
      });
    })();
    </script>

  </head>
  <body id="idp">
        
    <div id="container1">
      <div id="col1">&nbsp;</div>
          
      <div id="col2">

        <div id="header">&nbsp;</div>
        <div id="banner">
          <div id="logo">
            <h1><a accesskey="1" href="http://www.duke.edu" tabindex="1">Duke</a></h1>
            <h2>SIGN IN</h2>
          </div>
        </div>
  
        <div id="main">
          <div id="content">
            <div id="portlet">

              <h3><span>SIGN IN</span></h3>
              <div id="portlet-content">











  
        
        
          <form action="/idp/authn/external" method="post">
        
          <label for="j_username">NetID:</label>
          <input class="text" type="text" id="j_username" name="j_username" maxlength="16" autocorrect="off" autocapitalize="off">
          <label for="j_password">Password:</label>
          <input class="text" type="password" id="j_password" name="j_password" value="">

          <div id="login_options_heading_required" style="display:none"><br /><h3><span>ADVANCED VERIFICATION</span></h3></div>
          <div id="login_options_heading_optional" style="display:none"><br /><h3><span>ADVANCED VERIFICATION (OPTIONAL)</span></h3></div>
          <div id="login_options"></div>
          <span id="advanced_verification_options2" style="display:none">
            <span class="notes">
              Advanced verification already complete.
              <br />
            </span>
            <br />
          </span>

          <input style="padding-bottom: 0px; margin-bottom: 0px" class="button" id="Submit" name="Submit" type="submit" value="Enter">
          <span id="advanced_verification_options1" style="display:none">
            <input type="checkbox" id="rememberme" name="rememberme" style="display: inline; margin-bottom: 0px;" />
            <label for="rememberme" style="display: inline; font-size: 0.7em;"> Remember this device for 12 hours</label>
            <span id="rememberme_question" class="question"><a target="_blank" href="https://idms-mfa.oit.duke.edu/mfa/help?open=authentication_rememberme_link#authentication_rememberme_anchor">?</a></span>
            <input type="hidden" name="rememberme_value" id="rememberme_value" value="0" />
            <br /><br />
            <div id="rememberme_slider" style="display:none; font-size: 62.5%; width: 50%;"></div>
            <br />
          </span>
          <br />

          <input id="passwordEntered" type="hidden" value="0" />
          <input id="disableAutoCheck" type="hidden" value="0" />
          <input id="disableMFACheck" type="hidden" value="0" />
          <input id="doneWeight" type="hidden" value="0.0" />
          <input id="doneMFAWeight" type="hidden" value="0.0" />
          <input id="requiredWeight" type="hidden" value="1.0" />
          <input id="multiFactorCookieStrength" type="hidden" value="0.0" />
          <input id="multiFactorCookieTest" type="hidden" value="0" />
          <input id="multiFactorOptional" type="hidden" value="0" />
          <input name="use_default_login_page" type="hidden" value="1" />

          <input id="mfaCookie_fp1" name="mfaCookie_fp1" type="hidden" value="" />
          <input id="mfaCookie_fp2" name="mfaCookie_fp2" type="hidden" value="" />
          <input id="mfaCookie_plugins" name="mfaCookie_plugins" type="hidden" value="" />
          <input id="mfaCookie_fonts" name="mfaCookie_fonts" type="hidden" value="" />
          <input id="mfaCookie_timezone" name="mfaCookie_timezone" type="hidden" value="" />
          <input id="mfaCookie_screen" name="mfaCookie_screen" type="hidden" value="" />
          <input id="mfaCookie_language" name="mfaCookie_language" type="hidden" value="" />
          <input id="mfaCookie_extra" name="mfaCookie_extra" type="hidden" value="" />

          <input id="loginPageTime" name="loginPageTime" type="hidden" value="1479598551606" />
        </form>
        <div class="notes">
          <p class="MFAAdditional" style="display:none"><a href="https://idms-mfa.oit.duke.edu/mfa/help?open=authentication_forgotdevice_link#authentication_forgotdevice_anchor">Forgot your device?</a></p>
          <p><a href="https://pwreset.oit.duke.edu/">Forgot your password?</a></p>
          <p class="MFAAdditional" style="display:none"><a href="https://idms-mfa.oit.duke.edu/mfa/help?open=authentication_newdevice_link#authentication_newdevice_anchor">Have a new device?</a></p>
          
          You are on the correct Duke sign-in page if the URL above begins with <i>https://shib.oit.duke.edu/</i>.
        </div>

    <script type="text/javascript">
      $("#j_username").keyup(function(event) {
        event.preventDefault();

        var code = event.keyCode || event.which;
        if (typeof code != 'undefined') {
          if (code != 9 && code != 13) {
            $("#disableMFACheck").val("0");
          }
        }
      });

      $("#j_username").blur(function(event) {
        event.preventDefault();

        if ($("#j_username").val().length == 0) {
          return;
        }

        $("#disableAutoCheck").val("1");
        if ($("#disableMFACheck").val() == "1") {
          return;
        }

        $("#disableMFACheck").val("1");

        checkDeviceReady(function() {

        if ($("#j_username").val().length > 0) {
          if (passwordPopulated() && $("#passwordEntered").val() == "0") {
            $("#passwordEntered").val("1");
            $("#doneWeight").val(parseFloat($("#doneMFAWeight").val()) + 1.0).change();
          }

          $('#login_options').replaceWith("<div id='login_options'><br /><img src='/idp/images/loading_animation.gif' alt='Reloading' /></div>");
          var username = $('#j_username').val();
          var mfaCookie_fp1 = $('#mfaCookie_fp1').val();
          var mfaCookie_fp2 = $('#mfaCookie_fp2').val();
          var mfaCookie_plugins = $('#mfaCookie_plugins').val();
          var mfaCookie_fonts = $('#mfaCookie_fonts').val();
          var mfaCookie_timezone = $('#mfaCookie_timezone').val();
          var mfaCookie_screen = $('#mfaCookie_screen').val();
          var mfaCookie_language = $('#mfaCookie_language').val();

          jQuery.post("/idp/authn/external", { j_username_prefMech: username, mfaCookie_fp1 : mfaCookie_fp1, mfaCookie_fp2 : mfaCookie_fp2, mfaCookie_plugins : mfaCookie_plugins, mfaCookie_fonts : mfaCookie_fonts, mfaCookie_timezone : mfaCookie_timezone, mfaCookie_screen : mfaCookie_screen, mfaCookie_language : mfaCookie_language }, function(result) {
            $('#login_options').replaceWith("<div id='login_options'>" + result + "</div>");
            $("#doneWeight").change();
            if (parseFloat($("#requiredWeight").val()) > 1 && 1.0 == 1) {
              $(".MFAAdditional").show();

              $("#login_options_heading_optional").hide();
              $("#login_options_heading_required").show();

              if (parseFloat($("#multiFactorCookieStrength").val()) > 0) {
                $("#advanced_verification_options2").show();
              } else {
                $("#advanced_verification_options1").show();
              }

              if ($(".expandLink").length == 1) {
                $(".expandLink").click();
              }
            } else if ($("#multiFactorOptional").val() == "1" && 1.0 == 1) {
              $(".MFAAdditional").show();

              $("#login_options_heading_required").hide();
              $("#login_options_heading_optional").show();

              if (parseFloat($("#multiFactorCookieStrength").val()) > 0) {
                $("#advanced_verification_options2").show();
              } else {
                $("#advanced_verification_options1").show();
              }
            } else {
              $(".MFAAdditional").hide();
              $("#login_options_heading_required").hide();
              $("#login_options_heading_optional").hide();
              $("#advanced_verification_options1").hide();
              $("#advanced_verification_options2").hide();
            }

            if ($("#multiFactorCookieTest").val() == "1") {
              $("#rememberme").hide();
              $("label[for='rememberme']").hide();
              $("#rememberme_slider").show();
              $("#rememberme_value_wrapper_span").remove();
              $("#advanced_verification_options1").prepend("<span id='rememberme_value_wrapper_span' style='display: inline; font-size: 0.7em;'>Remember this browser for <span id='rememberme_value_span' style='display: inline;'>0</span> hours</span>");
            }

          });
        }
        });
      });

      $("#j_password").keyup(function (event) {
        event.preventDefault();
        if (passwordPopulated() && $("#passwordEntered").val() == "0") {
          $("#passwordEntered").val("1");
          $("#doneWeight").val(parseFloat($("#doneMFAWeight").val()) + 1.0).change();
        } else if (!passwordPopulated() && $("#passwordEntered").val() == "1") {
          $("#passwordEntered").val("0");
          $("#doneWeight").val(parseFloat($("#doneMFAWeight").val())).change();
        }
      });

      $("#doneWeight").change(function (event) {
        if ((parseFloat($("#doneWeight").val()) + parseFloat($("#multiFactorCookieStrength").val())) >= parseFloat($("#requiredWeight").val()) || parseFloat($("#requiredWeight").val()) == 1) {
          $("#Submit").prop("disabled", false);
        } else {
          $("#Submit").prop("disabled", true);
        }
      });

      window.onload = function () {
        $("#j_username").focus();
        setTimeout(function() { window.scrollTo(0, 1) }, 100);

        setInterval(function() {
          if ($("#j_username").val().length > 0 && passwordPopulated() && $("#disableAutoCheck").val() == "0") {
            $("#disableAutoCheck").val("1");
            $("#j_username").blur();
            $("#j_password").focus();
          }
        }, 250);

        setInterval(function() {
          if (passwordPopulated() && $("#passwordEntered").val() == "0") {
            $("#passwordEntered").val("1");
          } else if (!passwordPopulated() && $("#passwordEntered").val() == "1") {
            $("#passwordEntered").val("0");
          }

          if (passwordPopulated()) {
            $("#doneWeight").val(parseFloat($("#doneMFAWeight").val()) + 1.0).change();
          } else {
            $("#doneWeight").val(parseFloat($("#doneMFAWeight").val())).change();
          }
        }, 250);

        checkDevice();
      }
    </script>

  
              </div>
            </div>
            <div class="help">
              <p>For assistance, please visit <a href="http://oit.duke.edu/help">http://oit.duke.edu/help</a> or <a href="http://dhts.duke.edu">http://dhts.duke.edu</a>.</p>
              <p id="results"></p>
            </div>
          </div>
        </div>
      </div>
      <div id="col3">&nbsp;</div>
    </div>
  </body>
</html>
